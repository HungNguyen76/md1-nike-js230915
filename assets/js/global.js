let listProductsStock = [
    {
        img: "../assets/images/productItems/MEN/jordan-nu-retro-1-low.webp",
        name: "Jordan Nu Retro 1 Low",
        price: 3089000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jordan-nu-retro-1-low-purple.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-nu-retro-1-low-yellow.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-nu-retro-1-low-red.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/air-jordan-1-mid-shoes-SQf7DM.jpeg",
        name: "Air Jordan 1 Mid Shoes",
        price: 3669000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-shoes-SQf7DM.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-shoes-SQf7DM.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/air-jordan-1-mid-se.webp",
        name: "Air Jordan 1 Mid SE",
        price: 3959000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-se.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-se.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jordan-one-take-4-pf-shoes-v5trdl.jpeg",
        name: "Jordan One Take 4 Pf",
        price: 2929000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jordan-one-take-4-pf-shoes-v5trdl.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-one-take-4-pf-shoes-v5trdl.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jordan-series-es.webp",
        name: "Jordan Series ES",
        price: 2499000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jordan-series-es.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-series-es.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jumpman-mvp.webp",
        name: "Jumpman MVP",
        price: 4849000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jumpman-mvp.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jumpman-mvp.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low.webp",
        name: "AIR JORDAN 1 ELEVATE LOW",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
        name: "AIR JORDAN 1 ELEVATE LOW",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-low-se-shoes-Mzkmv0.jpeg",
        name: "AIR JORDAN 1 LOW SE",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-low-se-shoes-Mzkmv0.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-low-shoes-459b4T.jpeg",
        name: "AIR JORDAN 1 LOW SE",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-low-shoes-459b4T.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-low-shoes-459b4T.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jordan-nu-retro-1-low.webp",
        name: "Jordan Nu Retro 1 Low",
        price: 3089000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jordan-nu-retro-1-low.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-nu-retro-1-low-red.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/air-jordan-1-mid-shoes-SQf7DM.jpeg",
        name: "Air Jordan 1 Mid Shoes",
        price: 3669000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-shoes-SQf7DM.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-shoes-SQf7DM.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/air-jordan-1-mid-se.webp",
        name: "Air Jordan 1 Mid SE",
        price: 3959000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-se.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/air-jordan-1-mid-se.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jordan-one-take-4-pf-shoes-v5trdl.jpeg",
        name: "Jordan One Take 4 Pf",
        price: 2929000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jordan-one-take-4-pf-shoes-v5trdl.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-one-take-4-pf-shoes-v5trdl.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jordan-series-es.webp",
        name: "Jordan Series ES",
        price: 2499000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jordan-series-es.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jordan-series-es.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/MEN/jumpman-mvp.webp",
        name: "Jumpman MVP",
        price: 4849000,
        type: "MEN",
        options: [
            {
                src: "../assets/images/productItems/MEN/jumpman-mvp.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/MEN/jumpman-mvp.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low.webp",
        name: "AIR JORDAN 1 ELEVATE LOW",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low.webp",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
        name: "AIR JORDAN 1 ELEVATE LOW",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-low-se-shoes-Mzkmv0.jpeg",
        name: "AIR JORDAN 1 LOW SE",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-low-se-shoes-Mzkmv0.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-elevate-low-se-shoes-rk6X6b.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    },
    {
        img: "../assets/images/productItems/WOMEN/air-jordan-1-low-shoes-459b4T.jpeg",
        name: "AIR JORDAN 1 LOW SE",
        price: 4849000,
        type: "WOMEN",
        options: [
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-low-shoes-459b4T.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            },
            {
                src: "../assets/images/productItems/WOMEN/air-jordan-1-low-shoes-459b4T.jpeg",
                sizes: [
                    {
                        key: "S",
                        stock: 10
                    },
                    {
                        key: "M",
                        stock: 10
                    },
                    {
                        key: "L",
                        stock: 10
                    }
                ]
            }
        ]
    }
]

function uuid() {
    return new Date().getMilliseconds() + Math.floor(Math.random() * 999999999)
}

let listUsers = JSON.parse(localStorage.getItem("listUsers")) || []

console.log("listUsers: ", listUsers)
/*listUsers.push({
    idUser: uuid(),
    email: "admin@gmail.com",
    password: "123456",
    password_confirmation: "123456",
    cartUser: [],
    isAdmin: true
})*/
localStorage.setItem("listUsers", JSON.stringify(listUsers))

//Duyệt mảng listProductsStock để thêm id cho từng product (uuid()) và thêm quantity, gán = 1
listProductsStock.forEach(item => {
    item.id = uuid();
    item.quantity = 1;
})

//Duyệt mảng listProductsStock và duyệt tiếp mảng options để thêm idOption (uuid)
listProductsStock.forEach(item => {
    item.options.forEach(option => option.idOption = uuid())
})

console.log("listProductStock: ", listProductsStock)
//setItem => key là "listProducts" đưa listProductsStock vào localstorage
localStorage.setItem("listProducts", JSON.stringify(listProductsStock))


//B1: tao ham renderListProduct(params) {}
//B2: tạo biến result = ""
//B3: loops mảng params và gán vào biến result nội dung sử dụng cú pháp template string
//B4: nội dung template string như sau:
/*
* <div class="">
    <div class="">
    *  <img />
    * </div>
    <div>
    *  <div>
            <span>params[i].type}</span>
            * <span>S-M-L</span>
            * </div>
            <h4>param[i].name<h4>
            * <p>price</p>
* sử dụng querySelector gán innerHTML = result
* css cho thẻ content-container = flex, display none
*
* */
const USDollar = new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD'
})
const VND = new Intl.NumberFormat('vi-VN', {
    style: 'currency',
    currency: 'VND'
})

//Hàm hiển thị danh sách sản phẩm
function renderListProduct(params) {
    let result = ""
    for (let i = 0; i < params.length; i++) {
        result += `
         <div class="product-item" onclick="renderProductItem('${params[i].id}')">
            <div class="product-image">
                <img src="${params[i].img}" alt="product1"/>
            </div>
            <div class="product-description">
                <div class="product-type">
                    <span>${params[i].type}</span>
                    <span>S-M-L</span>
                </div>
                <h4 class="product-name">${params[i].name}</h4>
                <p>${VND.format(params[i].price)}</p>
            </div>
         </div>
        `
    }
    document.querySelector(".content-container").innerHTML = result;
    document.querySelector(".content-container").style.display = "flex"
    document.querySelector(".banner-container").style.display = "none"
}
function renderListAllProducts() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    renderListProduct(listProducts)
    document.querySelector(".listPage").style.display = "block"
    pagination()
}
function renderMenListProduct() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    let listProductsMen = []
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].type == "MEN") {
            listProductsMen.push(listProducts[i])
        }
    }
    renderListProduct(listProductsMen)
    document.querySelector(".listPage").style.display = "none"
}
function renderWomenListProduct() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    let listProductsWomen = []
    for (let i = 0; i < listProducts.length; i++) {
        if (listProducts[i].type == "WOMEN") {
            listProductsWomen.push(listProducts[i])
        }
    }
    renderListProduct(listProductsWomen)
    document.querySelector(".listPage").style.display = "none"
}

//ham phan trang
function pagination() {
    let thisPage = 1;
    let limit = 8;
    let list = document.querySelectorAll(".product-item")

    function loadItem() {
        let beginGet = limit * (thisPage - 1 )
        let endGet = limit * thisPage - 1
        list.forEach((item, key) => {
            if(key >= beginGet && key <= endGet) {
                item.style.display = "block"
            } else {
                item.style.display = "none"
            }
        })
        listPage()
    }
    loadItem()

    function listPage() {
        let count = Math.ceil(list.length / limit)
        document.querySelector('.listPage').innerHTML = ''

        if(thisPage != 1) {
            let prev = document.createElement("li")
            prev.innerText = 'PREV'
            prev.setAttribute('onclick', "changePage(" + (thisPage - 1) + ")")
            document.querySelector('.listPage').appendChild(prev)
        }
        for(let i = 1; i <= count; i++) {
            let newPage = document.createElement("li")
            newPage.innerText = i;
            if(i == thisPage) {
                newPage.classList.add('active')
            }
            newPage.setAttribute('onclick', "changePage(" + i + ")")
            document.querySelector(".listPage").appendChild(newPage)
        }
        if(thisPage != count) {
            let next = document.createElement("li")
            next.innerText = 'NEXT'
            next.setAttribute("onclick", "changePage(" + (thisPage + 1 ) + ")")
            document.querySelector('.listPage').appendChild(next)
        }
    }
    function changePage(i) {
        thisPage = i
        loadItem()
    }
    window.changePage = changePage

}

if(checkLogin()) {
    document.querySelector(".login-button").style.display = "none"
    document.querySelector(".logout-button").style.display = "block"
}
function checkLogin() {
    var getIsLogin = localStorage.getItem("checkLogin")

    if(getIsLogin == null) {
        return false
    } else {
        return true
    }
}
function checkLogout() {
    let confirmLogout = confirm("Bạn có muốn thoát không?")
    if(confirmLogout) {
        localStorage.removeItem("checkLogin")
        window.location.href = "homepage.html"
        document.querySelector(".logout-button").style.display = "none"
    }
}


function renderProductItem(idProduct) {

    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let productItem = listProducts.find((item) => {
        return item.id == idProduct
    })

    let result = `
        <div class="product">
            <div class="productItem-image">
                <div class="productItem-main-image">
                    <img src="${productItem.img}" alt="" class="main-image">
                </div>
                <div class="productItem-image-color">
            
                </div>
            </div>
            <div class="productItem-description">
                <h2>${productItem.name}</h2>
                <h3>${VND.format(productItem.price)}</h3>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Sapiente error totam harum iste deserunt
                suscipit enim aliquam nihil veritatis quam minima architecto ad corporis, facere ut veniam et quas
                culpa.
                </p>
                <h4>Size</h4>
                <div>
                    <input type="radio" id="S" value="S" name="size" class="size-option">
                    <label for="S">S</label>
                    <br>
                    <input type="radio" id="M" value="M" name="size" class="size-option">
                    <label for="M">M</label>
                    <br>
                    <input type="radio" id="L" value="L" name="size" class="size-option">
                    <label for="L">L</label>
                </div>
                <button class="addtocart-button" onclick="addToCart('${productItem.id}')">ADD TO CART</button><br>
                <p class="product-idOption">${productItem.options[0].idOption}</p>
                <span class="stock-size-S">Size S available in stock ${productItem.options[0].sizes[0].stock}</span><br>
                <span class="stock-size-M">Size M available in stock ${productItem.options[0].sizes[1].stock}</span><br>
                <span class="stock-size-L">Size L available in stock ${productItem.options[0].sizes[2].stock}</span>
            </div>
        </div>
        `;
    document.querySelector(".content-container").style.display = "flex";
    document.querySelector(".content-container").innerHTML = result;
    document.querySelector(".banner-container").style.display = "none";
    document.querySelector(".listPage").style.display = "none"
    let productItemColor = document.querySelector(".productItem-image-color");

    let productColors = "";
    for (let i = 0; i < productItem.options.length; i++) {

        productColors += `
            <img src="${productItem.options[i].src}" alt="" onclick="changeProductColor(${idProduct}, '${productItem.options[i].src}', '${productItem.options[i].idOption}')">
        `
    }
    productItemColor.innerHTML = productColors;
}

function changeProductColor(idProduct, src, idOption) {

    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let product = listProducts.find((product) => {
        return product.id == idProduct;
    })
    let option = product.options.find((option) => {
        return option.idOption == idOption;
    })
    document.querySelector(".main-image").src = `${src}`;
    document.querySelector(".product-idOption").innerHTML = `${idOption}`;

    document.querySelector(".stock-size-S").innerHTML = `Size S available in stock ${option.sizes[0].stock}`;
    document.querySelector(".stock-size-M").innerHTML = `Size M available in stock ${option.sizes[1].stock}`;
    document.querySelector(".stock-size-L").innerHTML = `Size L available in stock ${option.sizes[2].stock}`;
}

//Hàm hiển thị danh sách sản phẩm trong giỏ hàng
function addToCart(idProduct) {
    let checkLogin = localStorage.getItem("checkLogin");

    if (checkLogin == null) {
        showErrorNotLoginToast();
        return;
    }

    let listProducts = JSON.parse(localStorage.getItem("listProducts"));
    let listUsers = JSON.parse(localStorage.getItem("listUsers"));
    let selectedSize = null;
    let idOption = document.querySelector(".product-idOption").innerHTML;

    const sizeOptions = document.querySelectorAll(".size-option");
    for (let i = 0; i < sizeOptions.length; i++) {
        if (sizeOptions[i].checked) {
            selectedSize = sizeOptions[i].value;
            break;
        }
    }

    if (selectedSize === null) {
        showErrorSizeToast();
        return;
    }

    let product = listProducts.find((product) => {
        return product.id == idProduct;
    });

    let option = product.options.find((x) => {
        return x.idOption == idOption
    })

    let imageLink = option.src;
    let productName = product.name;
    let productPrice = product.price;

    for (let i = 0; i < listUsers.length; i++) {
        if (listUsers[i].idUser == checkLogin) {
            let cart = listUsers[i].cartUser;

            // Check if the product with the same idOption and selectedSize already exists in the cart
            let existingProduct = cart.find((item) => {
                return item.idOption == idOption && item.size == selectedSize;
            });

            if (existingProduct) {
                // Increment the quantity if the product already exists
                existingProduct.quantity++;
                localStorage.setItem("listUsers", JSON.stringify(listUsers));
                showCartProductTotal()
            } else {
                // Add the product to the cart with quantity 1, image link, and product name
                cart.push({
                    idProduct: idProduct,
                    idOption: idOption,
                    size: selectedSize,
                    quantity: 1,
                    imageLink: imageLink,
                    productName: productName,
                    productPrice: productPrice
                });
                localStorage.setItem("listUsers", JSON.stringify(listUsers));
                showCartProductTotal()

            }
        }
    }
}


function showCartProducts() {
    document.querySelector(".cartProducts-container").style.display = "block";
    document.querySelector(".navigation-container").style.opacity = 0.5;
    document.querySelector(".content-container").style.opacity = 0.5;
    document.querySelector(".banner-container").style.opacity = 0.5;

    let listUsers = JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin = localStorage.getItem("checkLogin");

    let user = listUsers.find((user) => {
        return user.idUser == checkLogin;
    })

    let cartUser = user ? user.cartUser : [];

    let result = "";
    for (let i = 0; i < cartUser.length; i++) {
        result += `
            <div class="cartProductItem" id = "cartProductItem_${i}">
                <div class="cartItem">
                    <div class="cartProductItem-image">
                        <img src="${cartUser[i].imageLink}" alt="">
                    </div>
                    <div class="cartProductItem-info">
                        <h4>${cartUser[i].productName}</h4>
                        <p>Product code: ${cartUser[i].idOption}</p>
                        <p>Size: ${cartUser[i].size}</p>
                        <p>${USDollar.format(cartUser[i].productPrice)}</p>
                            <div class="changeQuantity-button">
                                <button>
                                    <span class="material-symbols-outlined" onclick="decreaseItem(${i})">
                                        remove
                                    </span>
                                </button>
                                
                                <span class="productItem-quantity" id="quantity">${cartUser[i].quantity}</span>

                                <button>
                                    <span class="material-symbols-outlined" onclick="increaseItem(${i})">
                                        add
                                    </span>
                                </button>
                            </div>
                    </div>
                </div>
                <div class="cartItem-delete-button">
                        <span class="material-symbols-outlined" onclick="deleteProductItem(${i})">
                            close
                        </span>
                </div>
            </div>
        `;
    }
    document.querySelector(".cartProductItems").innerHTML = result;
    calculateTotalProductPrice()
}

function showCartProductTotal() {
    let listUsers = JSON.parse(localStorage.getItem("listUsers"));
    let checkLogin = localStorage.getItem("checkLogin");

    let user = listUsers.find((item) => {
        return item.idUser == checkLogin;
    })

    let cartUser = user ? user.cartUser : []

    let total = cartUser.reduce((total, currentValue) => {
        console.log("currentValue", currentValue)
        return total += currentValue.quantity;
    }, 0)

    document.querySelector(".navigation-right__cart--number").innerHTML = `${total}`;
}

showCartProductTotal();

document.querySelector(".cartProducts-close").addEventListener("click", () => {
    document.querySelector(".cartProducts-container").style.display = "none"
    document.querySelector(".navigation-container").style.opacity = 1
    document.querySelector(".content-container").style.opacity = 1
    document.querySelector(".banner-container").style.opacity =1
})

function calculateTotalProductPrice() {
    let listUsers = JSON.parse(localStorage.getItem("listUsers"))
    let checkLogin = localStorage.getItem("checkLogin")
    let user = listUsers.find(item => item.idUser == checkLogin)

    let cartUser = user ? user.cartUser : []

    let totalPrice = cartUser.reduce((total, currentValue) => {
        return total += currentValue.productPrice * currentValue.quantity
    },0)

    document.querySelector(".cartProducts-subTotal").innerHTML = `SUBTOTAL: ${VND.format(totalPrice)}`
}

function deleteProductItem(index) {
    let listUsers = JSON.parse(localStorage.getItem("listUsers"))
    let checkLogin = localStorage.getItem("checkLogin")
    let user = listUsers.find(item => item.idUser == checkLogin)
    let cartUser = user ? user.cartUser : []
    cartUser.splice(index, 1)
    localStorage.setItem("listUsers", JSON.stringify(listUsers))
    showCartProducts()
    showCartProductTotal()
    calculateTotalProductPrice()
}
function decreaseItem(index) {
    let listUsers = JSON.parse(localStorage.getItem("listUsers"))
    let checkLogin = localStorage.getItem("checkLogin")
    for (let i = 0; i < listUsers.length; i++) {
        //kiểm tra người dùng vừa đăng nhập
        if(listUsers[i].idUser == checkLogin) {
            //lấy giỏ hàng của user vừa đăng nhập
            let cartUser = listUsers[i].cartUser
            for (let j = 0; j < cartUser.length; j++) {
                //nếu quantity > 1, thì giảm quantity - 1
                if(cartUser[index].quantity > 1) {
                    cartUser[index].quantity -= 1;
                    localStorage.setItem("listUsers", JSON.stringify(listUsers))
                    showCartProducts();
                    showCartProductTotal()
                    calculateTotalProductPrice()
                    return
                } else {
                    //nếu user giảm quantity dưới 1, thì xoá cart item
                    cartUser.splice(index, 1)
                    localStorage.setItem("listUsers", JSON.stringify(listUsers))
                    showCartProducts()
                    showCartProductTotal()
                    calculateTotalProductPrice()
                    return
                }
            }
        }
    }
}
function increaseItem(index) {
    let listUsers = JSON.parse(localStorage.getItem("listUsers"))
    let checkLogin = localStorage.getItem("checkLogin")
    for (let i = 0; i < listUsers.length; i++) {
        //kiểm tra người dùng vừa đăng nhập
        if(listUsers[i].idUser == checkLogin) {
            //lấy giỏ hàng của user vừa đăng nhập
            let cartUser = listUsers[i].cartUser
            for (let j = 0; j < cartUser.length; j++) {
                //lấy được cart item và tăng quantity lên 1
                if(j == index) {
                    cartUser[j].quantity += 1;
                    localStorage.setItem("listUsers", JSON.stringify(listUsers))
                    showCartProducts();
                    showCartProductTotal()
                    calculateTotalProductPrice()
                    return
                }
            }
        }
    }
}

function searchProduct() {
    document.querySelector(".search-input").style.visibility = "visible"
}

function closeSearchProduct() {
    document.querySelector(".search-input").style.visibility = "hidden"
}
function deleteSearchInput() {
    document.querySelector(".search-input__product").value = "";
    document.querySelector(".searchProduct-container").innerHTML = "";
    document.querySelector(".content-container").style.opacity = 1;
}
function searchInputProduct() {
    let listProducts = JSON.parse(localStorage.getItem("listProducts"))
    let valueSearchInput = document.querySelector(".search-input__product").value;
    console.log("valueSearchInput", valueSearchInput)
    let resultSearch = []

    let userSearch = listProducts.filter(item => {
        return item.name.toUpperCase().includes(valueSearchInput.toUpperCase())
    })
    renderSearchInputProduct(userSearch)
}

function renderSearchInputProduct(params) {
    console.log("params: ", params)
    let result = ""
    for (let i = 0; i < params.length; i++) {
        result += `
            <div class="seacrh-ProductItem"  onclick="renderProductItem('${params[i].id}')">
                <div class="seacrh-ProductItem-image">
                    <img src="${params[i].img}" alt="" />
                </div>
                <div class="seacrh-ProductItem-info">
                    <h4>${params[i].name}</h4>
                    <p>${VND.format(params[i].price)}</p>
                </div>
            </div>
        `
    }
    document.querySelector(".searchProduct-container").innerHTML = result
    document.querySelector(".content-container").style.opacity = 0.5
}
function clearSearchResults() {
    document.querySelector(".searchProduct-container").innerHTML = "";
}
// Hàm xử lí khi người dùng xoá hết dữ liệu trong ô input thì ẩn vùng hiển thị sản phẩm người dùng đã tìm kiếm
document.querySelector(".search-input__product").addEventListener("input", handleInputClear);
function handleInputClear() {
    let valueInputSearch = document.querySelector(".search-input__product").value;

    if (valueInputSearch === "") {
        clearSearchResults();
        document.querySelector(".content-container").style.opacity = 1;
    }
}